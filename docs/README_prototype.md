# ソフトウェア要件定義書 (試作版)

## 1. 概要

### 1.1 目的
本試作版ソフトウェアは、Go 言語を用いて ECHONET Lite による通信を行うソフトウェアを開発する上での技術的な実現可能性を評価し、開発の感触を掴むことを目的とする。

### 1.2 参照元ドキュメント
本試作版のスコープは、以下の最終成果物要件定義書に基づき、その一部を抜粋・簡略化したものである。
- `README.md`

## 2. スコープ
本試作版では、「README.md」で定義された最終成果物の機能のうち、以下のコア機能を中心に実装する。複雑な制御ロジックや網羅的な機能実装はスコープ外とする。

## 3. 機能要件（試作範囲）

### 3.1 設定ファイル読み込み
- 「README.md」セクション 4.2 で定義された設定ファイルから、以下の基本的な項目を読み込む機能。
  - EIBS7 の IP アドレス
  - 監視間隔 (秒)
  - Syslog 設定 (最低限、出力先がわかる程度)
- (参照: `README.md` 4.2)

### 3.2 ECHONET Lite 通信フレームワーク (最小限)
- ECHONET Lite フレーム (EHD, TID, SEOJ, DEOJ, ESV, OPC, EPC, PDC, EDT) を表現する Go のデータ構造（構造体など）を定義する。
- 上記データ構造とバイト列との間で相互に変換（シリアライズ/デシリアライズ）する関数を実装する。
- (参照: `README.md` 3.3)

### 3.3 UDP 通信
- 設定ファイルから読み込んだ IP アドレスの ECHONET Lite ポート (3610) に対して、UDP データグラムを送信する機能。
- UDP ポートで応答データグラムを受信する機能。
- 簡単な応答タイムアウト処理を実装する。
- (参照: `README.md` 3.3)

### 3.4 基本的なデータ取得 (Get)
- 設定ファイルから読み込んだ監視間隔に基づき、定期的に以下のプロパティに対する Get 要求フレームを送信する。
  - 蓄電池 (`027D01`): 蓄電残量3 (EPC `0xE4`)
  - 住宅用太陽光発電 (`027901`): 瞬時発電電力計測値 (EPC `0xE0`)
  - (オプション) 分電盤メータリング (`028701`): 瞬時電力計測値 (EPC `0xC6`)
  - (オプション) マルチ入力PCS (`02A501`): 瞬時電力計測値 (EPC `0xE7`)
- 受信した応答フレームを解析し、TID が一致し、ESV が成功 (`0x72`) であることを確認する。
- 成功応答から EDT (プロパティ値データ) をデコードし、取得した値をログに出力する。
- (参照: `README.md` 3.1.1, 3.1.2, 3.3)

### 3.5 (オプション) 基本的な制御 (Set)
- もし開発に余裕があれば、以下の Set 要求を試みる。
  - 蓄電池 (`027D01`) の運転モード設定 (EPC `0xDA`) に対して、固定値 (例: `0x46` 自動 または `0x42` 充電) を設定する Set 要求フレームを送信する。
  - 応答フレームを受信し、TID が一致し、ESV が成功 (`0x74`) または設定不可 (`0x51` 等) であることを確認し、結果をログに出力する。
- (参照: `README.md` 3.2.1, 3.2.2, 3.3)

## 4. 非機能要件（試作範囲）

### 4.1 ログ出力
- 取得した監視データ（上記 3.4 で取得したもの）、通信エラー（タイムアウト、エラー応答）、簡単なアプリケーションの動作状況（起動など）を syslog に出力する機能。
- (参照: `README.md` 4.1)

### 4.2 クロスコンパイル
- 開発環境 (macOS) 上で、実行環境 (Linux/ARM, 例: Raspberry Pi) 向けの単一ネイティブバイナリを `go build` コマンド等を用いて生成できることを確認する。
- (参照: `README.md` 1.4)

## 5. スコープ外
以下の項目は、本試作版のスコープ外とする。

- 「README.md」に記載されている複雑な制御ロジック全般
  - 充電電力設定値の計算と自動設定
  - 閾値を用いた運転モードの自動切り替えロジック
  - モード変更頻度抑制ロジック
- 太陽高度計算による充電時間帯推定
- 全ての監視項目・制御項目の網羅的な実装
- 詳細なエラーハンドリング、リトライ処理、エラーリカバリ
- Syslog 設定の詳細なカスタマイズ
- その他、「README.md」に記載されている機能・非機能要件のうち、上記「3. 機能要件」「4. 非機能要件」に含まれないものすべて。
